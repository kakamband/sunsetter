{exec} = require 'child_process'

task 'compile', 'Compiles coffee in static/src/ to JS', ->
	compile()

task 'compress', 'Runs UglifyJS all JS files and create source-map', ->
	compress()

task 'build', 'Does the full build magic', ->
	compile -> compress()

compile = (callback) ->
	exec 'coffee --map --compile static/src/', (err, stdout, stderr) ->
		throw err if err
		console.log "Compiled Coffee files"
		callback?()

compress = (callback) ->
	exec 'uglifyjs static/src/*.js static/vendor/*.js
	--compress
	--output static/js/app.min.js
	--in-source-map static/src/tools.map
	--source-map static/js/app.min.js.map
	--source-map-root /
	--source-map-url app.min.js.map', (err, stdout, stderr) ->
		throw err if err
		console.log "Compressed app.min.js"
		callback?()
