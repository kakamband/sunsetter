(function(){var getAzimuth,getHash,queryEphemerides,queryMatch,setHash,strToLatLng,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};$(function(){var bounds,hash,latlng,los,map,markerpos,myOptions,poimarker,poipos,povmarker,povpos;return latlng=google.loader.ClientLocation?new google.maps.LatLng(google.loader.ClientLocation.latitude,google.loader.ClientLocation.longitude):new google.maps.LatLng(35.41,139.44),myOptions={zoom:9,center:latlng,mapTypeId:google.maps.MapTypeId.ROADMAP},map=new google.maps.Map(document.getElementById("map_canvas"),myOptions),markerpos=new google.maps.LatLng(1,1),povmarker=new google.maps.Marker({position:markerpos,map:map,icon:"/static/img/man.png",draggable:!0,visible:!1}),poimarker=new google.maps.Marker({position:markerpos,map:map,draggable:!0,visible:!1}),los=new google.maps.Polyline({path:[povmarker.getPosition(),poimarker.getPosition()],strokeColor:"#FF0000",strokeOpacity:0,strokeWeight:6}),los.setMap(map),google.maps.event.addListener(map,"click",function(event){return povmarker.getVisible()?poimarker.getVisible()?void 0:(poimarker.setPosition(event.latLng),poimarker.setVisible(!0),los.setOptions({strokeOpacity:.6}),$("#azimuth").show(),queryMatch(povmarker,poimarker),$("#step2").removeClass("active",500),$("#step3").addClass("active",500)):(povmarker.setPosition(event.latLng),povmarker.setVisible(!0),$("#step1").removeClass("active",500),$("#step2").addClass("active",500))}),$([povmarker,poimarker]).each(function(i,marker){return google.maps.event.addListener(marker,"position_changed",function(){return los.setPath([povmarker.getPosition(),poimarker.getPosition()]),document.az=getAzimuth(povmarker.getPosition(),poimarker.getPosition()),$("#azimuth").text(document.az.round(2)+"ยบ"),$("#results").html("")})}),$([povmarker,poimarker]).each(function(i,marker){return google.maps.event.addListener(marker,"dragend",function(){return queryMatch(povmarker,poimarker)})}),$("#reset").click(function(){return povmarker.setOptions({position:markerpos,visible:!1}),poimarker.setOptions({position:markerpos,visible:!1}),los.setOptions({strokeOpacity:0}),$("#step1").addClass("active",500),$("#step2").removeClass("active",500),$("#step3").removeClass("active",500),$("#azimuth").hide(),$("#results").html(""),window.location.hash=""}),hash=getHash(),__indexOf.call(Object.keys(hash),"pov")>=0&&__indexOf.call(Object.keys(hash),"poi")>=0?(povpos=strToLatLng(hash.pov),poipos=strToLatLng(hash.poi),povmarker.setPosition(povpos),poimarker.setPosition(poipos),povmarker.setVisible(!0),poimarker.setVisible(!0),los.setOptions({strokeOpacity:.6}),bounds=new google.maps.LatLngBounds,bounds.extend(povpos),bounds.extend(poipos),map.fitBounds(bounds),$("#step1").removeClass("active",500),$("#step3").addClass("active",500),$("#azimuth").show(),queryMatch(povmarker,poimarker)):navigator.geolocation?navigator.geolocation.getCurrentPosition(function(position){return latlng=new google.maps.LatLng(position.coords.latitude,position.coords.longitude),map.panTo(latlng)}):void 0}),getAzimuth=function(pov,poi){var dLon,poiLat,povLat,x,y;return povLat=pov.lat().toRad(),poiLat=poi.lat().toRad(),dLon=(poi.lng()-pov.lng()).toRad(),y=Math.sin(dLon)*Math.cos(poiLat),x=Math.cos(povLat)*Math.sin(poiLat)-Math.sin(povLat)*Math.cos(poiLat)*Math.cos(dLon),Math.atan2(y,x).toBrng()},setHash=function(pov,poi){var poipos,povpos;return povpos=pov.getPosition().toUrlValue(),poipos=poi.getPosition().toUrlValue(),window.location.hash="pov="+povpos+"&poi="+poipos},getHash=function(){var vars;return vars={},window.location.hash.replace(/[#&]+([^=&]+)=([^&]*)/gi,function(m,key,value){return vars[key]=value}),vars},strToLatLng=function(str){var coord;return coord=str.split(","),new google.maps.LatLng(coord[0],coord[1])},queryEphemerides=function(pov){var povlat;return povlat=pov.getPosition().lat().round(1),$.ajax({type:"POST",url:"/GetEphemerides",data:{lat:povlat},dataType:"json",success:function(reply){return document.ephemerides=reply}})},queryMatch=function(pov,poi){var povlat;return document.spinner=new Spinner({lines:13,length:7,width:4,radius:10,rotate:0,color:"#333",speed:1,trail:60,shadow:!1,hwaccel:!0,className:"spinner",zIndex:2e9,top:"auto",left:"auto"}).spin($("#results")[0]),_gaq.push(["_trackEvent","Interaction","Request"]),povlat=pov.getPosition().lat().round(1),$.ajax({type:"POST",url:"/findMatch",data:{lat:povlat,az:document.az},dataType:"json",success:function(reply){var day,daylist,_i,_len,_ref;if(null!=reply.matches){for(daylist=$("<ul>").addClass("matches"),_ref=reply.matches,_i=0,_len=_ref.length;_len>_i;_i++)day=_ref[_i],daylist.append($("<li>").text(day));return $("#results").text(""+reply.suntype+" on:").append(daylist),_gaq.push(["_trackEvent","Interaction","Success",reply.suntype])}return $("#results").text("Sorry, there is no "+reply.suntype+" in this direction."),_gaq.push(["_trackEvent","Interaction","Success","Out of Bounds"])},error:function(){return $("#results").text("ERROR in the Request."),_gaq.push(["_trackEvent","Interaction","Error"])},complete:function(){return document.spinner.stop(),setHash(pov,poi)}})},Number.prototype.toRad=function(){return this*Math.PI/180},Number.prototype.toDeg=function(){return 180*this/Math.PI},Number.prototype.toBrng=function(){return(this.toDeg()+360)%360},Number.prototype.round=function(decimals){return Math.round(this*Math.pow(10,decimals))/Math.pow(10,decimals)}}).call(this),function(a,b,c){function g(a,c){var e,d=b.createElement(a||"div");for(e in c)d[e]=c[e];return d}function h(a){for(var b=1,c=arguments.length;c>b;b++)a.appendChild(arguments[b]);return a}function j(a,b,c,d){var g=["opacity",b,~~(100*a),c,d].join("-"),h=.01+100*(c/d),j=Math.max(1-(1-a)/b*(100-h),a),k=f.substring(0,f.indexOf("Animation")).toLowerCase(),l=k&&"-"+k+"-"||"";return e[g]||(i.insertRule("@"+l+"keyframes "+g+"{"+"0%{opacity:"+j+"}"+h+"%{opacity:"+a+"}"+(h+.01)+"%{opacity:1}"+(h+b)%100+"%{opacity:"+a+"}"+"100%{opacity:"+j+"}"+"}",0),e[g]=1),g}function k(a,b){var f,g,e=a.style;if(e[b]!==c)return b;for(b=b.charAt(0).toUpperCase()+b.slice(1),g=0;d.length>g;g++)if(f=d[g]+b,e[f]!==c)return f}function l(a,b){for(var c in b)a.style[k(a,c)||c]=b[c];return a}function m(a){for(var b=1;arguments.length>b;b++){var d=arguments[b];for(var e in d)a[e]===c&&(a[e]=d[e])}return a}function n(a){for(var b={x:a.offsetLeft,y:a.offsetTop};a=a.offsetParent;)b.x+=a.offsetLeft,b.y+=a.offsetTop;return b}var f,d=["webkit","Moz","ms","O"],e={},i=function(){var a=g("style");return h(b.getElementsByTagName("head")[0],a),a.sheet||a.styleSheet}(),o={lines:12,length:7,width:5,radius:10,rotate:0,color:"#000",speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"auto",left:"auto"},p=function q(a){return this.spin?(this.opts=m(a||{},q.defaults,o),void 0):new q(a)};p.defaults={},m(p.prototype,{spin:function(a){this.stop();var h,i,b=this,c=b.opts,d=b.el=l(g(0,{className:c.className}),{position:"relative",zIndex:c.zIndex}),e=c.radius+c.length+c.width;if(a&&(a.insertBefore(d,a.firstChild||null),i=n(a),h=n(d),l(d,{left:("auto"==c.left?i.x-h.x+(a.offsetWidth>>1):c.left+e)+"px",top:("auto"==c.top?i.y-h.y+(a.offsetHeight>>1):c.top+e)+"px"})),d.setAttribute("aria-role","progressbar"),b.lines(d,b.opts),!f){var j=0,k=c.fps,m=k/c.speed,o=(1-c.opacity)/(m*c.trail/100),p=m/c.lines;!function q(){j++;for(var a=c.lines;a;a--){var e=Math.max(1-(j+a*p)%m*o,c.opacity);b.opacity(d,c.lines-a,e,c)}b.timeout=b.el&&setTimeout(q,~~(1e3/k))}()}return b},stop:function(){var a=this.el;return a&&(clearTimeout(this.timeout),a.parentNode&&a.parentNode.removeChild(a),this.el=c),this},lines:function(a,b){function e(a,d){return l(g(),{position:"absolute",width:b.length+b.width+"px",height:b.width+"px",background:a,boxShadow:d,transformOrigin:"left",transform:"rotate("+~~(360/b.lines*c+b.rotate)+"deg) translate("+b.radius+"px"+",0)",borderRadius:(b.width>>1)+"px"})}for(var d,c=0;b.lines>c;c++)d=l(g(),{position:"absolute",top:1+~(b.width/2)+"px",transform:b.hwaccel?"translate3d(0,0,0)":"",opacity:b.opacity,animation:f&&j(b.opacity,b.trail,c,b.lines)+" "+1/b.speed+"s linear infinite"}),b.shadow&&h(d,l(e("#000","0 0 4px #000"),{top:"2px"})),h(a,h(d,e(b.color,"0 0 1px rgba(0,0,0,.1)")));return a},opacity:function(a,b,c){a.childNodes.length>b&&(a.childNodes[b].style.opacity=c)}}),!function(){function a(a,b){return g("<"+a+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',b)}var b=l(g("group"),{behavior:"url(#default#VML)"});!k(b,"transform")&&b.adj?(i.addRule(".spin-vml","behavior:url(#default#VML)"),p.prototype.lines=function(b,c){function f(){return l(a("group",{coordsize:e+" "+e,coordorigin:-d+" "+-d}),{width:e,height:e})}function k(b,e,g){h(i,h(l(f(),{rotation:360/c.lines*b+"deg",left:~~e}),h(l(a("roundrect",{arcsize:1}),{width:d,height:c.width,left:c.radius,top:-c.width>>1,filter:g}),a("fill",{color:c.color,opacity:c.opacity}),a("stroke",{opacity:0}))))}var j,d=c.length+c.width,e=2*d,g=2*-(c.width+c.length)+"px",i=l(f(),{position:"absolute",top:g,left:g});if(c.shadow)for(j=1;c.lines>=j;j++)k(j,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(j=1;c.lines>=j;j++)k(j);return h(b,i)},p.prototype.opacity=function(a,b,c,d){var e=a.firstChild;d=d.shadow&&d.lines||0,e&&e.childNodes.length>b+d&&(e=e.childNodes[b+d],e=e&&e.firstChild,e=e&&e.firstChild,e&&(e.opacity=c))}):f=k(b,"animation")}(),a.Spinner=p}(window,document);
//@ sourceMappingURL=static/js/app.min.js.map