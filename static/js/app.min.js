!function(){var getAzimuth,getHash,queryEphemerides,queryMatch,setHash,strToLatLng,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};$(function(){var bounds,hash,latlng,los,map,markerpos,myOptions,poimarker,poipos,povmarker,povpos;return latlng=google.loader.ClientLocation?new google.maps.LatLng(google.loader.ClientLocation.latitude,google.loader.ClientLocation.longitude):new google.maps.LatLng(35.41,139.44),google.maps.visualRefresh=!0,myOptions={zoom:9,center:latlng,mapTypeId:google.maps.MapTypeId.ROADMAP},map=new google.maps.Map(document.getElementById("map_canvas"),myOptions),markerpos=new google.maps.LatLng(1,1),povmarker=new google.maps.Marker({position:markerpos,map:map,icon:"/static/img/man.png",draggable:!0,visible:!1}),poimarker=new google.maps.Marker({position:markerpos,map:map,draggable:!0,visible:!1}),los=new google.maps.Polyline({path:[povmarker.getPosition(),poimarker.getPosition()],strokeColor:"#FF0000",strokeOpacity:0,strokeWeight:6}),los.setMap(map),google.maps.event.addListener(map,"click",function(event){return povmarker.getVisible()?poimarker.getVisible()?void 0:(poimarker.setPosition(event.latLng),poimarker.setVisible(!0),los.setOptions({strokeOpacity:.6}),$("#azimuth").show(),queryMatch(povmarker,poimarker),$("#step2").removeClass("active",500),$("#step3").addClass("active",500)):(povmarker.setPosition(event.latLng),povmarker.setVisible(!0),$("#step1").removeClass("active",500),$("#step2").addClass("active",500))}),$([povmarker,poimarker]).each(function(i,marker){return google.maps.event.addListener(marker,"position_changed",function(){return los.setPath([povmarker.getPosition(),poimarker.getPosition()]),document.az=getAzimuth(povmarker.getPosition(),poimarker.getPosition()),$("#azimuth").text(document.az.round(2)+"ยบ"),$("#results").html("")})}),$([povmarker,poimarker]).each(function(i,marker){return google.maps.event.addListener(marker,"dragend",function(){return queryMatch(povmarker,poimarker)})}),$("#reset").click(function(){return povmarker.setOptions({position:markerpos,visible:!1}),poimarker.setOptions({position:markerpos,visible:!1}),los.setOptions({strokeOpacity:0}),$("#step1").addClass("active",500),$("#step2").removeClass("active",500),$("#step3").removeClass("active",500),$("#azimuth").hide(),$("#results").html(""),window.location.hash=""}),hash=getHash(),__indexOf.call(Object.keys(hash),"pov")>=0&&__indexOf.call(Object.keys(hash),"poi")>=0?(povpos=strToLatLng(hash.pov),poipos=strToLatLng(hash.poi),povmarker.setPosition(povpos),poimarker.setPosition(poipos),povmarker.setVisible(!0),poimarker.setVisible(!0),los.setOptions({strokeOpacity:.6}),bounds=new google.maps.LatLngBounds,bounds.extend(povpos),bounds.extend(poipos),map.fitBounds(bounds),$("#step1").removeClass("active",500),$("#step3").addClass("active",500),$("#azimuth").show(),queryMatch(povmarker,poimarker)):navigator.geolocation?navigator.geolocation.getCurrentPosition(function(position){return latlng=new google.maps.LatLng(position.coords.latitude,position.coords.longitude),map.panTo(latlng)}):void 0}),getAzimuth=function(pov,poi){var dLon,poiLat,povLat,x,y;return povLat=pov.lat().toRad(),poiLat=poi.lat().toRad(),dLon=(poi.lng()-pov.lng()).toRad(),y=Math.sin(dLon)*Math.cos(poiLat),x=Math.cos(povLat)*Math.sin(poiLat)-Math.sin(povLat)*Math.cos(poiLat)*Math.cos(dLon),Math.atan2(y,x).toBrng()},setHash=function(pov,poi){var poipos,povpos;return povpos=pov.getPosition().toUrlValue(),poipos=poi.getPosition().toUrlValue(),window.location.hash="pov="+povpos+"&poi="+poipos},getHash=function(){var vars;return vars={},window.location.hash.replace(/[#&]+([^=&]+)=([^&]*)/gi,function(m,key,value){return vars[key]=value}),vars},strToLatLng=function(str){var coord;return coord=str.split(","),new google.maps.LatLng(coord[0],coord[1])},queryEphemerides=function(pov){var povlat;return povlat=pov.getPosition().lat().round(1),$.ajax({type:"POST",url:"/GetEphemerides",data:{lat:povlat},dataType:"json",success:function(reply){return document.ephemerides=reply}})},queryMatch=function(pov,poi){var povlat;return document.spinner=new Spinner({lines:13,length:7,width:4,radius:10,rotate:0,color:"#333",speed:1,trail:60,shadow:!1,hwaccel:!0,className:"spinner",zIndex:2e9,top:"auto",left:"auto"}).spin($("#results")[0]),_gaq.push(["_trackEvent","Interaction","Request"]),povlat=pov.getPosition().lat().round(1),$.ajax({type:"POST",url:"/findMatch",data:{lat:povlat,az:document.az},dataType:"json",success:function(reply){var day,daylist,_i,_len,_ref;if(null!=reply.matches){for(daylist=$("<ul>").addClass("matches"),_ref=reply.matches,_i=0,_len=_ref.length;_len>_i;_i++)day=_ref[_i],daylist.append($("<li>").text(day));return $("#results").text(""+reply.suntype+" on:").append(daylist),_gaq.push(["_trackEvent","Interaction","Success",reply.suntype])}return $("#results").text("Sorry, there is no "+reply.suntype+" in this direction."),_gaq.push(["_trackEvent","Interaction","Success","Out of Bounds"])},error:function(){return $("#results").text("ERROR in the Request."),_gaq.push(["_trackEvent","Interaction","Error"])},complete:function(){return document.spinner.stop(),setHash(pov,poi)}})},Number.prototype.toRad=function(){return this*Math.PI/180},Number.prototype.toDeg=function(){return 180*this/Math.PI},Number.prototype.toBrng=function(){return(this.toDeg()+360)%360},Number.prototype.round=function(decimals){return Math.round(this*Math.pow(10,decimals))/Math.pow(10,decimals)}}.call(this),function(root,factory){"object"==typeof exports?module.exports=factory():"function"==typeof define&&define.amd?define(factory):root.Spinner=factory()}(this,function(){"use strict";function createEl(tag,prop){var n,el=document.createElement(tag||"div");for(n in prop)el[n]=prop[n];return el}function ins(parent){for(var i=1,n=arguments.length;n>i;i++)parent.appendChild(arguments[i]);return parent}function addAnimation(alpha,trail,i,lines){var name=["opacity",trail,~~(100*alpha),i,lines].join("-"),start=.01+100*(i/lines),z=Math.max(1-(1-alpha)/trail*(100-start),alpha),prefix=useCssAnimations.substring(0,useCssAnimations.indexOf("Animation")).toLowerCase(),pre=prefix&&"-"+prefix+"-"||"";return animations[name]||(sheet.insertRule("@"+pre+"keyframes "+name+"{"+"0%{opacity:"+z+"}"+start+"%{opacity:"+alpha+"}"+(start+.01)+"%{opacity:1}"+(start+trail)%100+"%{opacity:"+alpha+"}"+"100%{opacity:"+z+"}"+"}",sheet.cssRules.length),animations[name]=1),name}function vendor(el,prop){var pp,i,s=el.style;if(void 0!==s[prop])return prop;for(prop=prop.charAt(0).toUpperCase()+prop.slice(1),i=0;i<prefixes.length;i++)if(pp=prefixes[i]+prop,void 0!==s[pp])return pp}function css(el,prop){for(var n in prop)el.style[vendor(el,n)||n]=prop[n];return el}function merge(obj){for(var i=1;i<arguments.length;i++){var def=arguments[i];for(var n in def)void 0===obj[n]&&(obj[n]=def[n])}return obj}function pos(el){for(var o={x:el.offsetLeft,y:el.offsetTop};el=el.offsetParent;)o.x+=el.offsetLeft,o.y+=el.offsetTop;return o}function Spinner(o){return"undefined"==typeof this?new Spinner(o):(this.opts=merge(o||{},Spinner.defaults,defaults),void 0)}function initVML(){function vml(tag,attr){return createEl("<"+tag+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',attr)}sheet.addRule(".spin-vml","behavior:url(#default#VML)"),Spinner.prototype.lines=function(el,o){function grp(){return css(vml("group",{coordsize:s+" "+s,coordorigin:-r+" "+-r}),{width:s,height:s})}function seg(i,dx,filter){ins(g,ins(css(grp(),{rotation:360/o.lines*i+"deg",left:~~dx}),ins(css(vml("roundrect",{arcsize:o.corners}),{width:r,height:o.width,left:o.radius,top:-o.width>>1,filter:filter}),vml("fill",{color:o.color,opacity:o.opacity}),vml("stroke",{opacity:0}))))}var i,r=o.length+o.width,s=2*r,margin=2*-(o.width+o.length)+"px",g=css(grp(),{position:"absolute",top:margin,left:margin});if(o.shadow)for(i=1;i<=o.lines;i++)seg(i,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(i=1;i<=o.lines;i++)seg(i);return ins(el,g)},Spinner.prototype.opacity=function(el,i,val,o){var c=el.firstChild;o=o.shadow&&o.lines||0,c&&i+o<c.childNodes.length&&(c=c.childNodes[i+o],c=c&&c.firstChild,c=c&&c.firstChild,c&&(c.opacity=val))}}var useCssAnimations,prefixes=["webkit","Moz","ms","O"],animations={},sheet=function(){var el=createEl("style",{type:"text/css"});return ins(document.getElementsByTagName("head")[0],el),el.sheet||el.styleSheet}(),defaults={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"auto",left:"auto",position:"relative"};Spinner.defaults={},merge(Spinner.prototype,{spin:function(target){this.stop();var ep,tp,self=this,o=self.opts,el=self.el=css(createEl(0,{className:o.className}),{position:o.position,width:0,zIndex:o.zIndex}),mid=o.radius+o.length+o.width;if(target&&(target.insertBefore(el,target.firstChild||null),tp=pos(target),ep=pos(el),css(el,{left:("auto"==o.left?tp.x-ep.x+(target.offsetWidth>>1):parseInt(o.left,10)+mid)+"px",top:("auto"==o.top?tp.y-ep.y+(target.offsetHeight>>1):parseInt(o.top,10)+mid)+"px"})),el.setAttribute("role","progressbar"),self.lines(el,self.opts),!useCssAnimations){var alpha,i=0,start=(o.lines-1)*(1-o.direction)/2,fps=o.fps,f=fps/o.speed,ostep=(1-o.opacity)/(f*o.trail/100),astep=f/o.lines;!function anim(){i++;for(var j=0;j<o.lines;j++)alpha=Math.max(1-(i+(o.lines-j)*astep)%f*ostep,o.opacity),self.opacity(el,j*o.direction+start,alpha,o);self.timeout=self.el&&setTimeout(anim,~~(1e3/fps))}()}return self},stop:function(){var el=this.el;return el&&(clearTimeout(this.timeout),el.parentNode&&el.parentNode.removeChild(el),this.el=void 0),this},lines:function(el,o){function fill(color,shadow){return css(createEl(),{position:"absolute",width:o.length+o.width+"px",height:o.width+"px",background:color,boxShadow:shadow,transformOrigin:"left",transform:"rotate("+~~(360/o.lines*i+o.rotate)+"deg) translate("+o.radius+"px"+",0)",borderRadius:(o.corners*o.width>>1)+"px"})}for(var seg,i=0,start=(o.lines-1)*(1-o.direction)/2;i<o.lines;i++)seg=css(createEl(),{position:"absolute",top:1+~(o.width/2)+"px",transform:o.hwaccel?"translate3d(0,0,0)":"",opacity:o.opacity,animation:useCssAnimations&&addAnimation(o.opacity,o.trail,start+i*o.direction,o.lines)+" "+1/o.speed+"s linear infinite"}),o.shadow&&ins(seg,css(fill("#000","0 0 4px #000"),{top:"2px"})),ins(el,ins(seg,fill(o.color,"0 0 1px rgba(0,0,0,.1)")));return el},opacity:function(el,i,val){i<el.childNodes.length&&(el.childNodes[i].style.opacity=val)}});var probe=css(createEl("group"),{behavior:"url(#default#VML)"});return!vendor(probe,"transform")&&probe.adj?initVML():useCssAnimations=vendor(probe,"animation"),Spinner});
/*
//@ sourceMappingURL=app.min.js.map
*/